import * as tomato from "@po-to/tomato";
import * as tdom from "@po-to/tomato-jquery";
import * as project from "views/global/common/Project";
import * as funs from "views/global/common/Funs";
import * as model from "views/global/common/Model";
import * as api from "views/global/common/API";

class VPresenter extends project.VPresenter {
    private notificationStatus: number;
    constructor(view: tomato.VPView, parent?: tomato.VPresenter, vpid?: string) {
        super(view, parent, vpid);
        var that = this;
        window['deviceData'] = JSON.parse(localStorage.getItem("deviceData") + "");
        $(document).on('deviceDataChanged', function () {
            that.setInit();
        });
        this.find('input:checkbox').click(function (event) {
            event.preventDefault();
            if (that.find("input[type='checkbox']").is(':checked')) {
                //true选中
                that.notificationStatus = 1;
                that.changeNotifyStatus();
            } else {
                //false未选中
                that.notificationStatus = 0;
                that.changeNotifyStatus();
            }
        });
        // alert("window['deviceData'].notification_status == " + window['deviceData'].notification_status);
        that.setInit();
        // ////通讯录
        // this.find(".showBook").on('click', function () {
        //     if (window['deviceData'] && window['deviceData'].phone_contact_status == 1) {
        //         // alert("window['deviceData'].phone_contact_status == " + window['deviceData'].phone_contact_status + "::" + typeof (window['deviceData'].phone_contact_status));
        //         //此处去调native给我的接口
        //         that.showPhoneContact();
        //     } else {
        //         if (window['deviceData']) {
        //             alert("用户没给权限!phone_contact_status::" + window['deviceData'].phone_contact_status);
        //         }
        //         alert("用户没给权限!phone_contact_status::undefind");

        //     }
        // });
        this._watchEvent();
        this._els = this._getElements();
    }
    /**调native修改通知状态，给他传参数
     * 参数：notificationStatus 类型：int 值：1:打开通知；0:关闭通知
     */
    public changeNotifyStatus() {
        // alert("改变通知状态" + this.notificationStatus);
        if (funs.isAndroid()) {
            //android
            window.android_info.setAndroidNotificationStatus("0");
        } else {
            //ios
            window.webkit.messageHandlers.setIosNotificationStatus.postMessage(this.notificationStatus);
        }
    }
    // /**显示通讯录 */
    // public showPhoneContact() {
    //     // alert("显示通讯录");
    //     if (funs.isAndroid()) {
    //         //android
    //         window.android_info.getPhoneContact();
    //     } else {
    //         //ios
    //         window.webkit.messageHandlers.getPhoneContact.postMessage("传参数");
    //     }


    // }
    /**初始化 */
    private setInit() {
        if (window['deviceData'] && window['deviceData'].notification_status == 1) {
            $(".mui-switch").prop("checked", true);//默认选中checkbox
            // this.find(".set-notice").addClass("notice-checked");
            // alert("::" + window['deviceData'].notification_status);
        } else {
            $(".mui-switch").prop("checked", false);
            // this.find(".set-notice").removeClass("notice-checked");
            // alert("==" + window['deviceData'].notification_status);
        }
    }
    /**注销登录 */
    private _evt_logOut() {
        api.Logout(function () {
            //success
            window.location.href = '/index.html';
        }, function (error: tomato.PError) {
            //fail
            funs.tip(error.note, "", "fail");
        })
    }
}
export = VPresenter;