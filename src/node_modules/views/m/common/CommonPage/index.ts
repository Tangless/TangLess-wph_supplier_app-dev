import * as tomato from "@po-to/tomato";
import * as tdom from "@po-to/tomato-jquery";
import * as model from "views/global/common/Model";
import * as funs from "views/global/common/Funs";
import * as ejs from "ejs";

$(document).ready(function () {
    let indexCmd = new tomato.Cmd('/index.html', '首页', true);
    indexCmd.redo = indexCmd.execute = function () {
        tomato.getVPresenter<tomato.VPresenter>(funs.moduleToUrl('m/Index'), (mod) => {
            tomato.application.appendChild(mod);
            this.success();
        })
    }

    let mainModule = $("#doc").val();
    tomato.setConfig({
        application: new tdom.SinglePageApplication(indexCmd),
        renderer: { renderer: ejs.render }
    });

    //未登录
    if (model.globalData.user.user_type == 0) {
        tomato.getVPresenter<tomato.VPresenter>(funs.moduleToUrl('m/common/HomePage'), (mod) => {
            funs.loadPage(mod);
            $("#welcome").remove();
        })
    } else if (model.globalData.user.user_type == 1) {
        tomato.getVPresenter<tomato.VPresenter>(funs.moduleToUrl('m/joinUs/JoinSupplierPop'), (mod) => {
            //您不是工程商，需要立即加盟提示
            tdom.open(mod, tdom.DialogTarget.Blank, {
                size: { width: '90%', height: tomato.DialogSize.Content },
                effect: tdom.DialogEffect.scale,
                masked: true
            });
        });
    } else {
        if (mainModule) {
            if (mainModule.indexOf('DemandDetail') > 0) {
                mainModule += '?demand=' + window["globalData"].current_demand.id;
            }
            if (mainModule.indexOf('ChatRoom') > 0) {
                mainModule += '?uid=' + window["globalData"].current_demand.user.id;
            }
            tomato.getVPresenter<tomato.VPresenter>(mainModule, function (mod) {
                $("#welcome").remove();
                funs.loadPage(mod);
            });
        }
    }

});
//console.log(tomato.requireJS);